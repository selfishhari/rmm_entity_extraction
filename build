#Scripts to build and deploy RMM application

########### cloning the files from github
sudo yum update -y
sudo yum install git -y
git clone -b vignesh --single-branch https://username:password@github.com/selfishhari/rmm_entity_extraction.git

########### install mysql

sudo yum install mysql-server -y
sudo chkconfig mysqld on
sudo service mysqld start


########## Adding existing database and cs_entity table to database

cd rmm_entity_extraction/

cat rmm_extraction.sql | mysql -u <mysqluser> -p <dbname>

cat cs_entity.sql | mysql -u <mysqluser> -p <dbname>  

########## Setting up python with anaconda

wget https://anaconda.org/anaconda-adam/adam-installer/4.4.0/download/adam-installer-4.4.0-Linux-x86_64.sh

bash adam-installer-4.4.0-Linux-x86_64.sh -b -p ~/adam

echo -e '\n# Anaconda Adam\nexport PATH=~/adam/bin:$PATH' >> ~/.bashrc

conda create -n rmm_deploy python=3.6

conda activate rmm_deploy

sudo yum install -y mysql-devel

sudo yum install python-devel

sudo yum -y install gcc

pip install -U -r requirements.txt 

export rmm_user='USERNAME'

export rmm_password='PASSWORD'

sudo yum install tmux

# deployment
tmux new -s api

conda activate rmm_deploy

python rmm_entity_extraction/deploy_extraction_service.py

