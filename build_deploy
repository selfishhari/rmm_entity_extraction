#Scripts to build and deploy RMM application

########### cloning the files from github
sudo yum update -y
sudo yum install git -y
git clone -b vignesh --single-branch https://username:password@github.com/selfishhari/rmm_entity_extraction.git

########### install mysql

sudo yum install mysql-server -y
sudo chkconfig mysqld on
sudo service mysqld start

########## create username and password for mysql and create database

########## log into mysql using root and create new user and password

mysql -u root -p

cat user_db.sql | mysql -u <mysqluser> -p 

cat cs_entity.sql | mysql -u <mysqluser> -p <dbname>  

##### refer build_developer script for configuring database #############

##### install ngnix

sudo yum install epel-release

sudo yum install nginx

sudo systemctl start nginx

########## Setting up python with anaconda

cd rmm_entity_extraction/

sudo yum install -y python3

python3 -m venv rmm_venv

source rmm_venv/bin/activate

sudo yum install -y mysql-devel

sudo yum install python-devel

sudo yum -y install gcc

pip install -U -r requirements.txt 

#### downloading nltk packages#############

sudo python3 -m nltk.downloader -d /usr/local/share/nltk_data all

################# install gunicorn

pip install flask gunicorn

mkdir logs

############## build gunicorn

gunicorn -c gunicorn.conf -b 0.0.0.0:5000 deploy_extraction_service:app

###deactivate the virtual environment

deactivate 

#### write daemon file

cat sample_run > run.sh

### create daemon

sudo nano /etc/systemd/system/rmm.service

####copy and paste the service file

sudo systemctl daemon-reload

sudo systemctl start rmm

sudo systemctl enable rmm

##### To stop the server

sudo systemctl stop rmm

