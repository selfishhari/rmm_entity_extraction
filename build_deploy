#Scripts to build and deploy RMM application

########### cloning the files from github
sudo yum update -y
sudo yum install git -y
git clone -b vignesh --single-branch https://username:password@github.com/selfishhari/rmm_entity_extraction.git

########### install mysql

sudo yum install mysql-server -y
sudo chkconfig mysqld on
sudo service mysqld start

########## create username and password for mysql and create database

########## log into mysql using root and create new user and password

mysql -u root -p

CREATE USER 'newuser'@'localhost' IDENTIFIED BY 'password';

GRANT ALL PRIVILEGES ON * . * TO 'newuser'@'localhost';

CREATE DATABASE db_name;

##### refer build_developer script for configuring database #############

########## Setting up python with anaconda

cd rmm_entity_extraction/

wget https://repo.anaconda.com/archive/Anaconda3-2020.02-Linux-x86_64.sh

sha256sum Anaconda3-2020.02-Linux-x86_64.sh

bash Anaconda3-2020.02-Linux-x86_64.sh

conda list #to check installation

conda create -n rmm_deploy python=3.6

conda activate rmm_deploy

sudo yum install -y mysql-devel

sudo yum install python-devel

sudo yum -y install gcc

pip install -U -r requirements.txt 

#### downloading nltk packages using python3 shell

python3

import nltk

nltk.download('stopwords')

nltk.download('punkt')

exit()


################# install gunicorn

pip install flask gunicorn

mkdir logs

sudo nano gunicorn.conf

######## paste the following and change the directory

accesslog = "/home/ec2-user/rmm_entity_extraction/logs/gunicorn_access.log"
errorlog = "/home/ec2-user/rmm_entity_extraction/logs/gunicorn_error.log"

############## build gunicorn

gunicorn -c gunicorn.conf -b 0.0.0.0:5000 deploy_extraction_service:app

##### install tmux to run gunicorn

sudo yum install tmux

tmux new -s api

source activate rmm_deploy_service

gunicorn -c gunicorn.conf -b 0.0.0.0:5000 deploy_extraction_service:app
